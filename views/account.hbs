<div class = "container top-space">
    <div class = "row info-panel">
        <p>You need to verify your account before you can be used as a referral.</p>
        <button>Verify email (via email)</button>
        <button>Verify phone (via SMS)</button>
    </div>
</div>
<div class = "container" style = "margin-top: 5%">
    <div class = "row">
        <div class = "one-half column">
            <h3>Your referral account</h3>
            <h4>{{user.area}} {{user.prefix}} {{user.line}}</h4>
            <h5>{{user.email}}</h5>
        </div>
        <div class = "one-half column panel">
            <b>Bookmark this page so you can find it later!</b><br>
            This page is visible by anyone with the link.<br>
            <i>Don't share it with anybody!</i><br>
            If you lose this page, you can request it again <a href = "/">here</a>.
        </div>
    </div>
    <hr>
    <div class = "row">
        <h4>Update your information</h4>
        <div id = "error" class = "failure-panel bottom-space"></div>
        <input id = "email" type = "text" placeholder = "New email"></input>
        <button onclick = "updateEmail()">Change email address</button>
        <br>
        <input id = "area" size = "3" maxlength = "3" type = "text" placeholder = "555"></input>
        <input id = "prefix" size = "3" maxlength = "3" type = "text" placeholder = "555"></input>
        <input id = "line" size = "4" maxlength = "4" type = "text" placeholder = "5555"></input>
        <button onclick = "updatePhone()">Change referral number</button>
        <hr>
        <h4>Delete your account</h4>
        <b>This will remove your number and email address from the database. You will no longer be selected for referrals.</b><br><br>
        <button onclick = "deleteAccount()" class = "cancel">Delete my account</button>
    </div>
</div>

<script>

    $("#error").hide();

    function updateEmail() {
        post("/api/update_email", {id: "{{user.id}}", email: $("#email")[0].value}, function(data, status) {
            console.log(data, status);
            if (data.reload) window.location.reload(); else error(data.message);
        });
    }

    function updatePhone() {
        post("/api/update_phone", {id: "{{user.id}}", area: $("#area")[0].value, prefix: $("#prefix")[0].value, line: $("#line")[0].value}, function(data, status) {
            console.log(data, status);
            if (data.reload) window.location.reload(); else error(data.message);
        });
    }

    function deleteAccount() {
        post("/api/delete_account", {id: "{{user.id}}"}, function(data, status) {
            window.location.href = "/";
        });
    }

    function post(url, data, callback) {
        $.ajax({
            url: url,
            type: 'POST',
            contentType: 'application/json',
            data: JSON.stringify(data),
            success: callback
        });
    }

    function error(message) {
        if (message == undefined || message.length <= 0) { 
            $("#error").fadeOut(50); 
        } else {
            $("#error").fadeOut(50).fadeIn(100);
            $("#error").text(message);
        }
    }

</script>
<div class = "container large-top-space">
    <div class = "row bottom-space">
        <span class = "large title">Log in to PMReferrals.ca</span>
    </div>
    <div class = "row bottom-space">
        <div class="row">
            <div class = "one-half column">
                <!--select length = "4444" id = "carrierChooser" class = "u-full-width">
                    {{#each carrier_options}}
                        <option value = "{{this.id}}" {{#if this.selected}}selected{{/if}}>{{this.name}}</option>
                    {{/each}}
                </select-->
                <input class="u-full-width" type="text" placeholder="Username" id="usernameInput">
                <input class="u-full-width" type="text" placeholder="Referral code" id="codeInput">
                <div id = "errorMessage" class = "failure-panel top-space bottom-space">Error!!!</div>
            </div>
        </div>
        <div class = "row">
            <button id = "submitButton" class = "confirm button">Sign up</button>
        </div>
    </div>
</div>

<script>

    $('#submitButton').click(submit);
    $('#codeInput').click(keyUp);
    $('#usernameInput').focus();
    $('#errorMessage').hide();

    function keyUp(event) {
        if (event.keyCode == 13) submit();
    }

    function submit() {
        $("#errorMessage").hide();
        $.ajax({
        'url':'/login',
        'method':'POST',
        'dataType': 'json',
        'contentType': 'application/json',
        'data': JSON.stringify({
            "username": $("#usernameInput").val(),
            "password": $("#passwordInput").val(),
         }),
         'processData': false,
         'success': function (data, status) {
             if (!data.success) {
                 $("#errorMessage").html(data.reason);
                 $("#errorMessage").show();
             } else {
                 window.location.href = "/account";
             }
         }
      });
    }

</script>

